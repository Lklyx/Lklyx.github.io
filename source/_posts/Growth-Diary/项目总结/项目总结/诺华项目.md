---
title: 在诺华参与的项目。
date: 2021/10/28
categories:
- [历练ing,项目总结,诺华项目]
tags:
- 项目经历
- 成长 
---
# 项目介绍

`本次项目总共三个portal`

> **Main Portal**
>
> 因为是中途加入，所以并没有参与Main Portal开发。

> **Employee Portal** （Mr）
>
> Employee Portal是我主要负责的部分。
>
> ![项目截图](https://s.pc.qq.com/tousu/img/20211028/5928497_1635411119.jpg)
>
> **功能介绍：**
>
> 通过企业微信进入。展示mr的个人信息。信息中包含姓名，mr职位，以及个人mrid。可以查看到当前mr之下的公众号有那些，并展示当前公众号之中的的所有医生列表。医生列表中可以查看到：医生的名字，医生的各种状态，如：关注公众号状态、注册状态、dcr通过状态、黑名单管理状态、隐私协议的签署状态。医生所在的医院，所在的科室，以及服务权限，和展示医生的邀请二维码。
>
> **实现思路：**
>
> 把需要调用的接口写好。一次性引用过来。一共五个接口。分别是用户信息、公众号名字、医生列表、二维码接口、状态筛选接口。
>
> 1. 在登录进来的index页面获取登录进来的token。这时候做一个判断，判断登录时接口返回的数据中res.success === false，如果等于false，证明没有登录权限，这时候调用一个vant框架的弹窗组件(Dialog.alert)，将后台返回的登录失败的信息展示出来。在点击了确定之后返回到点击进入Employee的地方，++一个关闭当前微信网页的方法。++{.wavy .success}
>
>    ```js
>    document.addEventListener(
>        "WeixinJSBridgeReady",
>        function () {
>            WeixinJSBridge.call("closeWindow");
>        },
>        false
>    );
>    WeixinJSBridge.call("closeWindow");
>    ```
>
>    把这个写在vant框架的Dialog.alert的`.then`中。否则就正常进入MR中。将从这个接口中获取的token、userInfo、staffcode。保存起来。后面需要用到staffcode去拿到里面的mrid。当前的页面重定向到医生列表信息也。[this.$router.push("/doctorList")]{.bule}。
>
> 2. 进入doctorList医生列表页面。一进页面就在vue生命周期钩子函数`mounted`里面调用staffCode方法，这个方法是调用用户信息接口的，所以在一进来就需要渲染出来，入参是登录时候获取的staffcode。接口返回用户的姓名、用户的职位、用户的员工号（mrid）。在这个方法里面调用获取所有公众号名字接口，这时候传递一个mrid过去。所有公众号接口不需要入参，直接可以从中获取当前公众号的名字、ccAppId（公众的唯一ID标识）、当前公众号之下的所有人的唯一标识buType。
>
>    [**知识点：**]{.blue}
>
>    - 默认进来的tab默然选中第一个。所以取下标为0的属性值赋值给当前data定义的对应值。
>
>    给data赋值当前的ccappid、mrid。这时候默认都是tab中第一个的值。在所有公众号接口方法里面调用医生列表方法以进行第一次页面进来的默认渲染，（这次调用医生列表方法是第一次调用，里面不给当前List做渲染，而是在里面再调用一次真正式的医生列表方法才给List做赋值）入参是目标医生的ccappid和mrid。一进来的时候进入医生列表方法，判断当前的mr之下是否有医生。利用接口返回的总量字段**total**作为判断。
>
>    ```js
>    doctorList(params) {
>          console.log(params);
>          hcpList(params).then((res) => {
>            console.log(res);
>            if (res.data.total == 0) {
>              this.istotal = true; // 目标mr为空。
>              let params = {
>                pageNum: 1,
>              };
>              this.doctorListFormal(params);
>            } else {
>              let params = {
>                ccAppId: this.ccAppId,
>                mrId: this.mrId,
>              };
>              this.doctorListFormal(params);
>            }
>          });
>        },
>    ```
>
>    `功能：`++如果当前目标mr之下没有医生，则默认渲染全量的医生的前十条数据，不能什么也不暂时给他用户看++。如果total等于0.则当前目标mr之下没有医生。默认渲染全量的前十条数据，这时候调用医生列表的入参就变为只传一个pageNum，页数等于1。否则就正常入参，把当前公众号的ccAppId和mrid传过去，展示当前mr之下的工作号的所有医生。**细节：**这次调用医生列表方法不进行给当前的hcpList赋值，而是只做一个判断，在判断里面再调用一次医生列表接口方法进行赋值。
>
> 3. 在进入页面时、在vue生命周期函数`mounted`调用状态筛选列表接口。入参是一个数组类型。需要接口给我们返回当前状态的值，和状态的值的唯一id（code）。例子：状态值为：未关注。状态值的id（code）为0。这时候在页面就可以做双向绑定作为判断，如果等于1，就是已关注，如果等于0。就是未关注，当用户勾选单选框的时候，将双向绑定的id（code）传给后端已做模糊搜索。
>
>    [**知识点：**]{.blue}
>
>    - 数组的`concat()`方法。方法用于连接两个或多个数组。方法不会更改现有数组，而是返回一个新数组，其中包含已连接数组的值。
>    - vant框架里面的**van-radio**组件，前端展示一个单选按钮组，默认需要有一个全部的选项，接口中没有返回，所以需要用到`Arr.concat()`方法。将后端返回的和前端自己定义的结合在一起。
>    - vant中单选组件的双向绑定值、默认选中的话，默认定义的值要等于双向绑定的值。
>
> 4. 点击事件：点击Tab时，切换不同的公众号。

> **Admin Portal**

